SELECT
  CASE
    WHEN Amount < 100 THEN '<100'
    WHEN Amount BETWEEN 100 AND 499 THEN '100-499'
    WHEN Amount BETWEEN 500 AND 999 THEN '500-999'
    WHEN Amount >= 1000 THEN '1000+'
  END AS amount_bucket,
  COUNT(*) AS total_transactions,
  SUM(CASE WHEN Class = 1 THEN 1 ELSE 0 END) AS fraud_transactions,
  ROUND(SAFE_DIVIDE(SUM(CASE WHEN Class = 1 THEN 1 ELSE 0 END), COUNT(*)) * 100, 2) AS fraud_rate_percent
FROM
  `chargeback-analysis.chargeback_data.Transactions`
GROUP BY
  amount_bucket
ORDER BY
  amount_bucket;
